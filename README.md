# Торговый центр "Кристалл" - Административная панель

## Требования

- Node.js (версия 14 или выше)
- MySQL (версия 5.7 или выше)
- npm (входит в состав Node.js)

## Установка и настройка

1. Клонируйте репозиторий:
```bash
git clone <url-репозитория>
cd mall
```

2. Установите зависимости:
```bash
npm install
```

3. Создайте файл `.env` в корневой директории проекта и настройте переменные окружения:
```env
# Настройки базы данных
DB_HOST=localhost
DB_USER=ваш_пользователь
DB_PASS=ваш_пароль
DB_NAME=mall_db

# Настройки сервера
PORT=3000
NODE_ENV=development

# Секретный ключ для сессий
SESSION_SECRET=ваш_секретный_ключ

# Настройки почты (опционально)
MAIL_HOST=smtp.example.com
MAIL_PORT=587
MAIL_USER=your_email@example.com
MAIL_PASS=your_password
```

4. Создайте базу данных:
```bash
mysql -u root -p
CREATE DATABASE mall_db;
```

5. Запустите миграции для создания таблиц:
```bash
# Создание таблиц
npx sequelize-cli db:migrate

# В случае ошибок, можно откатить миграции
npx sequelize-cli db:migrate:undo:all
```

Миграции создадут следующие таблицы:
- `users` - пользователи системы (администраторы, менеджеры, клиенты)
- `movies` - фильмы в кинотеатре
- `screenings` - сеансы фильмов
- `cinema_tickets` - билеты на киносеансы
- `shops` - магазины торгового центра
- `events` - события и мероприятия
- `promotions` - акции и специальные предложения

Порядок выполнения миграций:
1. `20240318_create_users.js` - создание таблицы пользователей
2. `20240318_create_movies.js` - создание таблицы фильмов
3. `20240318_create_screenings.js` - создание таблицы сеансов
4. `20240318_create_cinema_tickets.js` - создание таблицы билетов
5. `20240318_create_shops.js` - создание таблицы магазинов
6. `20240318_create_events.js` - создание таблицы событий
7. `20240318_create_promotions.js` - создание таблицы акций

6. (Опционально) Заполните базу тестовыми данными:
```bash
npx sequelize-cli db:seed:all
```

7. Создайте администратора системы:
```bash
npx sequelize-cli db:seed --seed 20240318-create-admin-user.js
```

Данные для входа администратора по умолчанию:
- Email: admin@mall.com
- Пароль: admin123
(Рекомендуется сменить пароль после первого входа)

## Запуск приложения

1. Для разработки:
```bash
npm run dev
```

2. Для продакшена:
```bash
npm start
```

Приложение будет доступно по адресу: http://localhost:3000

## Административная панель

Для доступа к административной панели перейдите по адресу: http://localhost:3000/admin

### Основные функции административной панели:

1. **Управление магазинами**
   - Создание нового магазина: `/admin/shops/create`
   - Поля для заполнения:
     - Название магазина (обязательно)
     - Категория (обязательно)
     - Этаж (обязательно)
     - Описание
     - Часы работы
     - Телефон
     - URL изображения

2. **Управление событиями**
   - Создание нового события: `/admin/events/create`
   - Поля для заполнения:
     - Название события (обязательно)
     - Описание
     - Дата (обязательно)
     - Время
     - Место проведения
     - URL изображения

3. **Управление акциями**
   - Создание новой акции: `/admin/promotions/create`
   - Поля для заполнения:
     - Название акции (обязательно)
     - Описание
     - Магазин (обязательно)
     - Дата начала (обязательно)
     - Дата окончания (обязательно)
     - Размер скидки (%)
     - URL изображения

4. **Управление фильмами и сеансами**
   - Создание нового фильма: `/admin/movies/create`
   - Поля для заполнения фильма:
     - Название фильма (обязательно)
     - Описание
     - Продолжительность (минут) (обязательно)
     - Жанр (обязательно)
     - Режиссер
     - Актеры
     - Дата выхода (обязательно)
     - Возрастное ограничение (обязательно)
     - URL постера
     - URL трейлера
     - Статус активности
   - Управление сеансами:
     - Дата и время сеанса
     - Номер зала
     - Цена билета
     - Количество доступных мест

## Структура проекта

```
mall/
├── src/
│   ├── config/         # Конфигурационные файлы
│   ├── controllers/    # Контроллеры
│   ├── middleware/     # Промежуточное ПО
│   ├── models/         # Модели Sequelize
│   ├── migrations/     # Миграции базы данных
│   └── routes/         # Маршруты
├── views/
│   ├── pages/          # Страницы
│   └── partials/       # Повторно используемые компоненты
├── public/             # Статические файлы
└── .env               # Переменные окружения
```

## Разработка

### Добавление новых функций

1. Создайте новую модель:
```bash
npx sequelize-cli model:generate --name ModelName --attributes field:type
```

2. Создайте новую миграцию:
```bash
npx sequelize-cli migration:generate --name migration-name
```

3. Добавьте маршруты в `src/routes/web/index.js`

4. Создайте представления в директории `views/pages/`

### Стилизация

- Все стили находятся в соответствующих `.ejs` файлах
- Используются CSS-переменные для единообразия оформления
- Основные цвета и размеры определены в корневых стилях

## Поддержка

При возникновении проблем:

1. Проверьте логи в консоли
2. Убедитесь, что все переменные окружения настроены правильно
3. Проверьте подключение к базе данных
4. Убедитесь, что все зависимости установлены корректно
5. При проблемах с миграциями:
   - Проверьте, что база данных создана и доступна
   - Попробуйте откатить миграции: `npx sequelize-cli db:migrate:undo:all`
   - Проверьте порядок выполнения миграций
   - Убедитесь, что все зависимые таблицы созданы перед созданием связей